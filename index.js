(()=>{"use strict";function e(e){e.classList.add("popup_opened"),document.addEventListener("keydown",o)}function t(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",o)}function o(e){"Escape"===e.key&&t(document.querySelector(".popup_opened"))}function r(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}let n="";const a=document.querySelector(".popup-picture__image"),c=document.querySelector(".popup-picture__title"),i=document.querySelector(".popup_image-open");const u=document.querySelector(".grid");function p(t,o,n=[],p,s,l){u.prepend(function(t,o,n,u,p,s){const l=document.querySelector(".template").content.querySelector(".grid__element").cloneNode(!0),d=l.querySelector(".grid__heart"),_=l.querySelector(".grid__heart-counter");return l.querySelector(".grid__title").textContent=t,l.querySelector(".grid__image").src=o,l.querySelector(".grid__image").alt=`Изображение ${t}`,l.querySelector(".grid__heart-counter").textContent=n.length,n.some((e=>e._id===p))&&d.classList.add("grid__heart_active"),l.querySelector(".grid__heart").addEventListener("click",(function(){d.classList.contains("grid__heart_active")?function(e,t,o){return fetch(`https://nomoreparties.co/v1/plus-cohort-28/cards/likes/${e}`,{method:"DELETE",headers:{authorization:"78bba5ba-993f-40b2-a4ae-e02179c22cc4","Content-Type":"application/json"}}).then(r)}(s).then((e=>{d.classList.remove("grid__heart_active"),_.textContent=e.likes.length})).catch((e=>console.log(e))):function(e,t,o){return fetch(`https://nomoreparties.co/v1/plus-cohort-28/cards/likes/${e}`,{method:"PUT",body:JSON.stringify({likes:[]}),headers:{authorization:"78bba5ba-993f-40b2-a4ae-e02179c22cc4","Content-Type":"application/json"}}).then(r)}(s).then((e=>{d.classList.add("grid__heart_active"),_.textContent=e.likes.length,n.push({_id:p})})).catch((e=>console.log(e)))})),l.querySelector(".grid__image").addEventListener("click",(()=>{a.src=o,c.textContent=t,a.alt=`Изображение ${t}`,e(i)})),u===p?l.querySelector(".grid__trash").addEventListener("click",(()=>{var e;(e=s,fetch(`https://nomoreparties.co/v1/plus-cohort-28/cards/${e}`,{method:"DELETE",headers:{authorization:"78bba5ba-993f-40b2-a4ae-e02179c22cc4","Content-Type":"application/json"}}).then(r)).then((()=>{l.closest(".grid__element").remove()})).catch((e=>{console.error(`Ошибка при удалении карточки: ${e}`)}))})):l.querySelector(".grid__trash").style.display="none",l}(t,o,n,p,s,l))}document.querySelectorAll(".popup__close");const s=document.querySelector(".popup_edit-profile"),l=document.querySelector(".popup__form-profile"),d=document.querySelector(".profile__info-name"),_=document.querySelector(".profile__info-work"),m=document.querySelector(".popup__input_txt_name"),h=document.querySelector(".popup__input_txt_profession"),y=document.querySelector(".popup__input_txt_name-add"),f=document.querySelector(".popup__input_link"),v=document.querySelector(".popup_add-card"),b=document.querySelector(".popup__form-add"),S=document.querySelector(".popup_avatar");let q=document.querySelector(".profile__avatar");const g=document.querySelector(".popup__input_link-avatar"),L=document.querySelector(".profile__edit-avatar"),E=document.querySelector(".popup__form-avatar"),k=document.querySelector(".popup__save-info"),C=document.querySelector(".popup__save-picture"),x=document.querySelector(".popup__save-avatar"),T=document.querySelector(".popup__loading-info"),A=document.querySelector(".popup__loading-picture"),j=document.querySelector(".popup__loading-avatar");function $(e,t,o){e?(t.classList.add("button__hidden"),o.classList.add("load__visible")):(t.classList.remove("button__hidden"),o.classList.remove("load__visible"))}const z={formInputError:"popup__input_type_error",inputError:"form__input-error",popupInput:".popup__input",popupSumbit:".popup__sumbit",formProfile:".popup__form-profile",sumbitDisable:"popup__sumbit_dsbl"},D=(e,t,o)=>{const r=e.querySelector(`.${t.id}-error`);t.classList.remove(o.formInputError),r.classList.remove(o.inputError),r.textContent=""},P=(e,t,o)=>{const r=e.querySelector(`.${t.id}-error`);t.classList.add(z.formInputError),r.textContent=o,r.classList.add(z.inputError)},I=(e,t)=>{const o=Array.from(e.querySelectorAll(t.popupInput)),r=e.querySelector(t.popupSumbit);N(o,r,t),o.forEach((n=>{n.addEventListener("input",(function(){((e,t,o)=>{t.validity.patternMismatch?t.setCustomValidity("Поле может содержать только латинские буквы, кириллические буквы, знаки дефиса и пробелы"):t.setCustomValidity(""),t.validity.valid?D(e,t,o):P(e,t,t.validationMessage)})(e,n,t),N(o,r,t)}))}))};function N(e,t,o){!function(e){return e.some((e=>!e.validity.valid))}(e)?(t.classList.remove(o.sumbitDisable),t.disabled=!1):(t.classList.add(o.sumbitDisable),t.disabled=!0)}function O(e,t){const o=e.querySelectorAll(t.popupInput),r=e.querySelector(t.popupSumbit),n=Array.from(e.querySelectorAll(t.popupInput));o.forEach((o=>{D(e,o,t)})),N(n,r,t)}(e=>{Array.from(document.querySelectorAll(e.formProfile)).forEach((t=>{t.addEventListener("submit",(function(e){e.preventDefault()})),I(t,e),Array.from(t.querySelectorAll(".form__set")).forEach((t=>{I(t,e)}))}))})(z),q.addEventListener("click",(function(){e(S)})),L.addEventListener("click",(function(){e(S)})),E.addEventListener("submit",(function(){var e;$(!0,x,j),g.textContent=q.src,q.src=g.value,(e={avatar:q.src},fetch("https://nomoreparties.co/v1/plus-cohort-28/users/me/avatar",{method:"PATCH",headers:{authorization:"78bba5ba-993f-40b2-a4ae-e02179c22cc4","Content-Type":"application/json"},body:JSON.stringify({avatar:e.avatar})}).then(r)).then((e=>{e.avatar=q.src,t(S)})).catch((e=>console.log(e))).finally((()=>{$(!1,x,j)}))})),document.querySelector(".profile__edit-img").addEventListener("click",(function(){e(s),m.value=d.textContent,h.value=_.textContent,O(l,z)}));const w=document.querySelector(".profile__add-button"),J=document.querySelector(".popup__form-add");w.addEventListener("click",(function(){e(v),O(J,z),J.reset()})),document.querySelectorAll(".popup").forEach((e=>{e.addEventListener("mousedown",(o=>{o.target.classList.contains("popup_opened")&&t(e),o.target.classList.contains("popup__close")&&t(e)}))})),l.addEventListener("submit",(function(e){var o;e.preventDefault(),$(!0,k,T),(o={name:m.value,about:h.value},fetch("https://nomoreparties.co/v1/plus-cohort-28/users/me",{method:"PATCH",headers:{authorization:"78bba5ba-993f-40b2-a4ae-e02179c22cc4","Content-Type":"application/json"},body:JSON.stringify({name:o.name,about:o.about})}).then(r)).then((e=>{d.textContent=e.name,_.textContent=e.about})).catch((e=>console.log(e))).finally((()=>{$(!1,k,T)})),t(s)})),b.addEventListener("submit",(function(e){e.preventDefault();const o=y.value,a=f.value;var c;$(!0,C,A),(c={name:o,link:a},fetch("https://nomoreparties.co/v1/plus-cohort-28/cards",{method:"POST",headers:{authorization:"78bba5ba-993f-40b2-a4ae-e02179c22cc4","Content-Type":"application/json"},body:JSON.stringify({name:c.name,link:c.link})}).then(r)).then((e=>{p(e.name,e.link,e.likes,e.owner._id,n,e._id)})).catch((e=>console.log(e))).finally((()=>{$(!1,C,A),b.reset(),t(v)}))})),Promise.all([fetch("https://nomoreparties.co/v1/plus-cohort-28/users/me",{headers:{"Content-Type":"application/json; charset=UTF-8",authorization:"78bba5ba-993f-40b2-a4ae-e02179c22cc4"},body:JSON.stringify()}).then(r),fetch("https://nomoreparties.co/v1/plus-cohort-28/cards",{headers:{"Content-Type":"application/json; charset=UTF-8",authorization:"78bba5ba-993f-40b2-a4ae-e02179c22cc4"},body:JSON.stringify()}).then(r)]).then((([e,t])=>{n=e._id,d.textContent=e.name,_.textContent=e.about,q.src=e.avatar,t.reverse().forEach((function(t){p(t.name,t.link,t.likes,t.owner._id,e._id,t._id)}))})).catch((e=>{console.error(`Произошла ошибка: ${e}`)}))})();